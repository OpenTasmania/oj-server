# /common/constants.yaml
# Central constants file for the OSM-OSRM Server project

# Feature flags
features:
  pgadmin_enabled: false
  pgagent_enabled: true

# Default values
defaults:
  admin_group_ip: "192.168.128.0/22"
  gtfs_feed_url: "https://www.transport.act.gov.au/googletransit/google_transit.zip"
  vm_ip_or_domain: "example.com"
  pg_tileserv_binary_location: "https://postgisftw.s3.amazonaws.com/pg_tileserv_latest_linux.zip"
  log_prefix: "[MAP-SETUP]"

  # Database defaults
  postgres:
    host: "127.0.0.1"
    port: 5432
    database: "gis"
    user: "osmuser"
    password: "yourStrongPasswordHere"

  # Container defaults
  container:
    runtime_command: "docker"
    osrm_image_tag: "osrm/osrm-backend:latest"

  # OSRM defaults
  osrm:
    data_base_dir: "/opt/osm_data"
    processed_dir: "/opt/osrm_processed_data"
    base_pbf_url: "https://download.geofabrik.de/australia-oceania/australia-latest.osm.pbf"
    base_pbf_filename: "australia-latest.osm.pbf"
    car_profile_port: 5000
    max_table_size_routed: 8000
    profile_lua_in_container: "/opt/car.lua"

  # Web server defaults
  apache:
    listen_port: 8080

  # Package preseeding
  package_preseeding:
    tzdata:
      areas: "select Australia"
      zones_australia: "select Hobart"
    unattended_upgrades:
      enable_auto_updates: "true boolean"

# Package lists for installation
packages:
  # Core prerequisite packages
  core_prereq:
    - "git"
    - "unzip"
    - "vim"
    - "build-essential"
    - "gir1.2-packagekitglib-1.0"
    - "gir1.2-glib-2.0"
    - "packagekit"
    - "python-apt-common"
    - "dirmngr"
    - "gnupg"
    - "apt-transport-https"
    - "lsb-release"
    - "ca-certificates"
    - "qemu-guest-agent"
    - "ufw"
    - "curl"
    - "wget"
    - "bash"
    - "btop"
    - "screen"

  # Python system packages
  python_system:
    - "python3"
    - "python3-pip"
    - "python3-venv"
    - "python3-dev"

  # PostgreSQL packages
  postgres:
    - "postgresql-17"
    - "libpq-dev"
    - "postgresql-common"
    - "postgis"
    - "postgresql-17-postgis-3"
    - "postgresql-17-postgis-3-scripts"

  # Font packages
  font:
    - "fontconfig"
    - "fonts-noto-core"
    - "fonts-noto-cjk"
    - "fonts-noto-ui-core"
    - "fonts-noto-mono"
    - "fonts-dejavu"
    - "fonts-dejavu-core"
    - "fonts-dejavu-extra"
    - "fonts-unifont"
    - "fonts-hanazono"
    - "fonts-sil-gentium-basic"
    - "fonts-firacode"
    - "fonts-crosextra-carlito"
    - "fonts-takao-gothic"
    - "fonts-takao-mincho"
    - "fonts-takao"

  # Mapping packages
  mapping:
    - "cmake"
    - "libbz2-dev"
    - "libstxxl-dev"
    - "libstxxl1v5"
    - "libxml2-dev"
    - "libzip-dev"
    - "libboost-all-dev"
    - "lua5.4"
    - "liblua5.4-dev"
    - "libtbb-dev"
    - "libluabind-dev"
    - "pkg-config"
    - "apache2"
    - "libapache2-mod-tile"
    - "renderd"
    - "mapnik-utils"
    - "python3-mapnik"
    - "libmapnik-dev"
    - "xmlstarlet"
    - "nginx"
    - "osm2pgsql"
    - "gdal-bin"
    - "osmium-tool"
    - "osmcoastline"

# Tasks and Steps definitions
# Steps make up tasks, and tasks can contain steps, tasks, or both
# Tasks cannot reference themselves (circular references)
tasks:
  # PostgreSQL Tools Task Group
  postgresql_tools:
    name: "PostgreSQL Tools"
    description: "PostgreSQL administration and management tools"
    enabled: false
    steps:
      - pgadmin
      - pgagent

  # Individual Tasks
  pgadmin:
    name: "pgAdmin"
    description: "Install pgAdmin web interface for PostgreSQL"
    enabled: false
    steps:
      - install_pgadmin_packages

  pgagent:
    name: "pgAgent"
    description: "Install pgAgent job scheduler for PostgreSQL"
    enabled: true
    steps:
      - install_pgagent_packages

# Steps definitions
steps:
  install_pgadmin_packages:
    name: "Install pgAdmin Packages"
    description: "Install pgAdmin packages from apt repositories"
    command: "sudo apt-get install -y pgadmin4"

  install_pgagent_packages:
    name: "Install pgAgent Packages"
    description: "Install pgAgent packages from apt repositories"
    command: "sudo apt-get install -y pgagent"
